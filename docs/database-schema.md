
# Database Schema for HEX THE ADD HUB

This document outlines the proposed database schema for the various features of the HEX THE ADD HUB application, adapted for Firebase (Firestore).

## 1. Authentication & Users (Leveraging Firebase Authentication)

Firebase Authentication handles user creation, login, social auth, and password resets directly. Firestore will store additional user profile information.

### `users` (Firestore Collection)
Stores additional user profile information beyond what Firebase Auth provides directly. Document ID is the Firebase Auth `uid`.
- `uid`: STRING (Primary Key - Firebase Auth UID)
- `name`: STRING (User's display name)
- `email`: STRING (Indexed, from Firebase Auth)
- `avatar_url`: STRING (Optional, URL to avatar image - can be Firebase Storage link)
- `bio`: STRING (Optional, user's biography, max 500 chars)
- `dashboard_layout_preferences`: MAP (Optional, stores user's dashboard widget layout and visibility)
  - e.g., `{ "widgetOrder": ["recommendations", "activity", "progress"], "widgetSettings": { "activity": { "span": 2, "visible": true } } }`
- `web3_wallets`: ARRAY of MAPS (Optional, stores linked Web3 wallet addresses)
  - `address`: STRING (Wallet address, unique within the array for this user)
  - `chain_id`: STRING (e.g., '0x1' for Ethereum Mainnet)
  - `linked_at`: TIMESTAMP
  - `is_primary`: BOOLEAN (Indicates if this is the primary wallet for interactions)
- `auth_providers_linked`: ARRAY of MAPS (Optional, to track which social providers are linked beyond Firebase Auth's own tracking for custom logic)
  - `provider_name`: STRING (e.g., 'google.com', 'github.com', 'facebook.com')
  - `provider_user_id`: STRING (User ID from the provider)
- `created_at`: TIMESTAMP (Default: Server Timestamp)
- `updated_at`: TIMESTAMP (Default: Server Timestamp)

*Note: `password_hash` is managed by Firebase Authentication.*

## 2. Portfolios & Projects

### `projects` (Firestore Collection)
Stores details about user-created projects. Document ID can be auto-generated by Firestore or a custom slug.
- `id`: STRING (Document ID)
- `user_id`: STRING (Foreign Key to `users.uid` - author, Indexed)
- `title`: STRING (Max 100 chars)
- `slug`: STRING (Unique, Indexed, for SEO-friendly URLs)
- `description`: STRING (Short description, max 250 chars)
- `long_description`: STRING (Optional, detailed description, supports Markdown)
- `image_url`: STRING (URL to project cover image, potentially Firebase Storage)
- `gallery_image_urls`: ARRAY of STRINGS (Optional, URLs to additional project images/videos)
- `project_link`: STRING (Optional, URL to live project or repository)
- `tags`: ARRAY of STRINGS (e.g., ['NFT', 'Solidity', 'AI']) (Indexed for filtering)
- `status`: STRING (e.g., 'draft', 'published', 'archived', Default: 'draft', Indexed)
- `published_at`: TIMESTAMP (Nullable, set when status becomes 'published')
- `created_at`: TIMESTAMP
- `updated_at`: TIMESTAMP

### `project_contributions` (Firestore Subcollection under `projects/{projectId}/contributions` or top-level collection)
Tracks user contributions to projects for points and activity (if collaborative projects are supported).
- `id`: STRING (Document ID)
- `user_id`: STRING (Foreign Key to `users.uid`, Indexed)
- `project_id`: STRING (Foreign Key to `projects.id`, Indexed)
- `contribution_type`: STRING (e.g., 'code_commit', 'design_asset', 'documentation', 'feedback')
- `description`: STRING (Optional, details about the contribution)
- `contribution_date`: TIMESTAMP
- `points_awarded`: NUMBER (Default: 0)

## 3. Courses & Learning

### `courses` (Firestore Collection)
Stores information about available courses.
- `id`: STRING (Document ID)
- `instructor_id`: STRING (Foreign Key to `users.uid`, Indexed)
- `title`: STRING (Max 150 chars)
- `slug`: STRING (Unique, Indexed, for SEO-friendly URLs)
- `description`: STRING (Short description, max 300 chars)
- `long_description`: STRING (Optional, detailed course page content, Markdown/HTML)
- `cover_image_url`: STRING (URL to course cover image)
- `promo_video_url`: STRING (Optional, URL to promotional video)
- `price_amount`: NUMBER (Nullable, if 'Free'. Stores amount in smallest currency unit, e.g., cents)
- `price_currency`: STRING (e.g., 'USD', 'ETH', Nullable. Fiat currency code or crypto symbol)
- `is_free`: BOOLEAN (Default: false, derived from price)
- `category`: STRING (Indexed, e.g., 'Blockchain', 'AI', 'Art')
- `level`: STRING (e.g., 'Beginner', 'Intermediate', 'Advanced', Indexed)
- `duration_text`: STRING (e.g., "6 weeks", "Approx 20 hours")
- `lessons_count`: NUMBER (Aggregated count of lessons, updated via trigger/backend)
- `status`: STRING (e.g., 'draft', 'published', 'archived', Default: 'draft', Indexed)
- `published_at`: TIMESTAMP (Nullable)
- `tags`: ARRAY of STRINGS (For search and filtering)
- `learning_objectives`: ARRAY of STRINGS
- `target_audience`: STRING
- `token_gating_rules`: MAP (Optional, defines access rules based on token/NFT ownership)
  - `contract_address`: STRING
  - `token_id`: STRING (Optional, for ERC721/ERC1155 specific token)
  - `min_balance`: NUMBER (Optional, for ERC20)
  - `chain_id`: STRING
- `created_at`: TIMESTAMP
- `updated_at`: TIMESTAMP

### `course_modules` (Firestore Subcollection under `courses/{courseId}/modules`)
- `id`: STRING (Document ID)
- `title`: STRING
- `description`: STRING (Optional)
- `order_index`: NUMBER (For ordering modules within a course)

### `course_lessons` (Firestore Subcollection under `courses/{courseId}/modules/{moduleId}/lessons`)
- `id`: STRING (Document ID)
- `title`: STRING
- `content_type`: STRING (e.g., 'video', 'text', 'quiz', 'assignment', 'external_link')
- `content_data`: MAP (Stores video URL, text content (Markdown/HTML), quiz structure, assignment details, external URL)
  - e.g., `{ "videoUrl": "...", "durationSeconds": 300 }` or `{ "text": "...", "estimatedReadMinutes": 5 }`
- `order_index`: NUMBER (For ordering lessons within a module)
- `estimated_duration_minutes`: NUMBER (Optional)
- `is_previewable`: BOOLEAN (Default: false, can this lesson be viewed by non-enrolled users?)

### `course_enrollments` (Firestore Collection)
Tracks user enrollment and progress. Document ID could be `userId_courseId`.
- `id`: STRING (Document ID)
- `user_id`: STRING (Foreign Key to `users.uid`, Indexed)
- `course_id`: STRING (Foreign Key to `courses.id`, Indexed)
- `enrolled_at`: TIMESTAMP
- `payment_id`: STRING (Optional, link to payment record if applicable)
- `progress_percentage`: NUMBER (0-100, Default: 0, calculated based on completed_lessons)
- `completed_lessons`: ARRAY of STRINGS (lesson_ids, Default: [])
- `last_accessed_lesson_id`: STRING (Nullable)
- `completed_at`: TIMESTAMP (Nullable)
- `certificate_nft_tx_hash`: STRING (Optional, if NFT certificate minted)
- `certificate_pdf_url`: STRING (Optional, link to generated PDF certificate)

### `course_ratings` (Firestore Subcollection under `courses/{courseId}/ratings`)
Document ID can be `user_id` to ensure one rating per user.
- `user_id`: STRING (Foreign Key to `users.uid`)
- `rating`: NUMBER (1-5)
- `comment`: STRING (Optional, max 500 chars)
- `created_at`: TIMESTAMP
- `updated_at`: TIMESTAMP

## 4. Leaderboard & Gamification

### `user_points` (Firestore Collection)
Stores aggregated points for users. Document ID is `user_id`.
- `user_id`: STRING (Document ID, Foreign Key to `users.uid`)
- `total_points`: NUMBER (Default: 0, Indexed for leaderboard queries)
- `monthly_points`: NUMBER (Default: 0, reset periodically via Cloud Function)
- `weekly_points`: NUMBER (Default: 0, reset periodically via Cloud Function)
- `rank_all_time`: NUMBER (Optional, denormalized rank, updated periodically)
- `rank_monthly`: NUMBER (Optional)
- `rank_weekly`: NUMBER (Optional)
- `last_point_activity_at`: TIMESTAMP (Useful for tie-breaking or recency)
- `last_updated_at`: TIMESTAMP

### `achievement_definitions` (Firestore Collection)
Defines available achievements. Document ID is `achievement_key`.
- `key`: STRING (Document ID, e.g., 'COURSE_COMPLETION_MASTER')
- `name`: STRING
- `description`: STRING
- `icon_name`: STRING (Lucide icon name or custom icon identifier/URL)
- `points_value`: NUMBER (Optional, points awarded when achieved)
- `criteria`: MAP (Optional, for defining specific unlock criteria for backend processing, e.g., `{ "type": "course_completions", "count": 5, "category": "AI" }`)
- `category`: STRING (e.g., 'Learning', 'Community', 'Creation')

### `user_achievements` (Firestore Collection)
Tracks achievements unlocked by users. Document ID could be `userId_achievementKey`.
- `id`: STRING (Document ID)
- `user_id`: STRING (Indexed)
- `achievement_key`: STRING (Foreign Key to `achievement_definitions.key`, Indexed)
- `achieved_at`: TIMESTAMP
- `metadata`: MAP (Optional, for achievement-specific data, e.g., `{ "course_id": "xyz" }`)

## 5. Dashboard & User Activity

### `user_activity_events` (Firestore Collection)
Stores various user activities for feeds, recommendations, and analytics.
- `id`: STRING (Document ID, auto-generated)
- `user_id`: STRING (Foreign Key to `users.uid`, Indexed)
- `event_type`: STRING (e.g., 'course_enrollment', 'lesson_completed', 'project_created', 'project_contribution', 'forum_post', 'achievement_unlocked', 'blog_post_liked', 'user_follow') (Indexed)
- `event_data`: MAP (Contextual data related to the event)
  - e.g., for 'course_enrollment': `{ "course_id": "uuid", "course_title": "Intro to Solidity" }`
  - e.g., for 'project_created': `{ "project_id": "uuid", "project_title": "My NFT Project" }`
- `timestamp`: TIMESTAMP (Indexed for sorting and querying by time)
- `points_earned`: NUMBER (Optional, if this specific event directly awarded points)

## 6. Blog

### `blog_posts` (Firestore Collection)
Stores blog articles.
- `id`: STRING (Document ID, auto-generated)
- `author_id`: STRING (Foreign Key to `users.uid`, Indexed)
- `title`: STRING (Max 150 chars)
- `slug`: STRING (Unique, Indexed, for SEO-friendly URLs)
- `excerpt`: STRING (Short summary, max 300 chars)
- `content_markdown`: STRING (Main content in Markdown format)
- `cover_image_url`: STRING (Optional, URL to cover image)
- `status`: STRING ('draft', 'published', 'archived', Default: 'draft', Indexed)
- `published_at`: TIMESTAMP (Nullable)
- `tags`: ARRAY of STRINGS (e.g., ['Web3', 'Tutorial', 'AI'], Indexed)
- `category`: STRING (Optional, e.g., 'Platform Updates', 'Creator Spotlights', Indexed)
- `view_count`: NUMBER (Default: 0, incremented via backend logic)
- `like_count`: NUMBER (Default: 0)
- `created_at`: TIMESTAMP
- `updated_at`: TIMESTAMP

### `blog_post_likes` (Firestore Collection or Subcollection)
To track user likes on blog posts. Document ID `userId_postId`.
- `user_id`: STRING
- `post_id`: STRING
- `liked_at`: TIMESTAMP

## 7. Community & Social (Planned - Basic Structure)

### `community_feed_items` (Firestore Collection - For broader community announcements, not user-specific activities covered by `user_activity_events`)
- `id`: STRING (Document ID)
- `author_id`: STRING (Foreign Key to `users.uid`, Nullable if system-generated, e.g., admin announcement)
- `item_type`: STRING (e.g., 'platform_announcement', 'new_feature', 'community_highlight')
- `title`: STRING
- `description`: STRING (Optional, can be Markdown)
- `link`: STRING (Optional, to a relevant page or external resource)
- `image_url`: STRING (Optional)
- `item_data`: MAP (Contextual data)
- `timestamp`: TIMESTAMP (Indexed)

### `direct_messages` (Firestore Collection)
Stores metadata for conversations.
- `conversation_id`: STRING (Document ID, e.g., sorted_user_ids_combined: `uid1_uid2`)
- `participants`: ARRAY of STRINGS (`user_id`s involved in the conversation, Indexed)
- `last_message_snippet`: STRING (Preview of the last message)
- `last_message_timestamp`: TIMESTAMP (Indexed for sorting conversations)
- `last_message_sender_id`: STRING
- `unread_counts`: MAP (Stores unread message count for each participant, e.g., `{ "userId1": 0, "userId2": 2 }`)
- `created_at`: TIMESTAMP
- `updated_at`: TIMESTAMP

#### `direct_messages/{conversation_id}/messages` (Firestore Subcollection)
Stores individual messages within a conversation.
- `id`: STRING (Document ID, auto-generated)
- `sender_id`: STRING (Foreign Key to `users.uid`)
- `content_type`: STRING (e.g., 'text', 'image', 'link')
- `content_data`: MAP (Stores text, image URL, link details)
- `timestamp`: TIMESTAMP (Indexed for ordering messages)
- `read_by`: ARRAY of STRINGS (`user_id`s who have read this message)

## 8. Life Tracking (User-Specific)

### `life_tracker_settings` (Firestore Document, path: `users/{userId}/settings/life_tracker_settings`)
Stores user-specific settings for the life tracking feature.
- `birth_date`: STRING (ISO "yyyy-MM-dd")
- `life_expectancy_years`: NUMBER
- `enable_notifications`: BOOLEAN
- `timezone`: STRING (Optional, IANA timezone name, e.g., "America/New_York")
- `updated_at`: TIMESTAMP (When settings were last updated)

## 9. Payments (General Structure)

### `payments` (Firestore Collection)
Tracks payment transactions.
- `id`: STRING (Document ID, auto-generated or from payment provider)
- `user_id`: STRING (Foreign Key to `users.uid`, Indexed)
- `item_id`: STRING (e.g., `course_id`, `subscription_plan_id`, Indexed)
- `item_type`: STRING (e.g., 'course_enrollment', 'subscription', Indexed)
- `amount`: NUMBER (Smallest currency unit)
- `currency`: STRING (e.g., 'USD', 'ETH')
- `payment_provider`: STRING (e.g., 'stripe', 'paypal', 'crypto_wallet')
- `provider_transaction_id`: STRING (Transaction ID from the payment provider, Indexed)
- `status`: STRING (e.g., 'pending', 'succeeded', 'failed', 'refunded', Indexed)
- `payment_method_details`: MAP (Optional, e.g., last 4 digits of card, wallet address used)
- `created_at`: TIMESTAMP
- `updated_at`: TIMESTAMP

## 10. Community Token (Planned)

### `community_token_stakes` (Firestore Collection)
Tracks user stakes of the community token.
- `id`: STRING (Document ID)
- `user_id`: STRING (Foreign Key to `users.uid`, Indexed)
- `amount_staked`: NUMBER
- `staked_at`: TIMESTAMP
- `rewards_claimed_at`: TIMESTAMP (Nullable)
- `updated_at`: TIMESTAMP

## 11. DAO Governance (Planned)

### `dao_proposals` (Firestore Collection)
Stores DAO governance proposals.
- `id`: STRING (Document ID)
- `proposer_id`: STRING (Foreign Key to `users.uid`, Indexed)
- `title`: STRING
- `description`: STRING (Markdown/HTML)
- `status`: STRING (e.g., 'pending_vote', 'active_vote', 'passed', 'failed', 'executed', Indexed)
- `created_at`: TIMESTAMP
- `voting_starts_at`: TIMESTAMP
- `voting_ends_at`: TIMESTAMP
- `execution_details`: MAP (Optional, for on-chain execution parameters like smart contract calls)
- `yes_votes`: NUMBER (Count or sum of voting power)
- `no_votes`: NUMBER
- `abstain_votes`: NUMBER
- `updated_at`: TIMESTAMP

### `dao_proposal_votes` (Firestore Subcollection under `dao_proposals/{proposalId}/votes` or top-level)
Document ID could be `user_id` to ensure one vote per user per proposal.
- `user_id`: STRING (Foreign Key to `users.uid`)
- `proposal_id`: STRING (Foreign Key to `dao_proposals.id`, Indexed)
- `vote_option`: STRING (e.g., 'for', 'against', 'abstain')
- `voting_power`: NUMBER (Based on token/NFT holding at snapshot time of proposal creation)
- `transaction_hash`: STRING (Optional, if vote is recorded on-chain)
- `voted_at`: TIMESTAMP

---
This Firestore schema prioritizes denormalization where appropriate for read efficiency, common in NoSQL databases. Security rules will be crucial to manage access. Cloud Functions can be used for periodic tasks like resetting monthly points, aggregating counts, or processing complex achievements.
The `updated_at` fields should ideally be managed using server timestamps for accuracy.
Consider using subcollections for related data that is often queried together with its parent document (e.g., `course_modules` under `courses`).
Indexing strategies will be critical for performance, especially for filtering and ordering on the leaderboard, courses, and projects pages.
